{# vim:set softtabstop=2: -#}
{% set title = 'Home' -%}
{#% set refresh = 15 %#}
{% include "_header.html" %}

    <div class="container">
        <h1 class="align-center">Prusa Link Debug Info Page</h1>

        <h2 class="align-center">Printer</h2>
        <ul>
            <li>Name: <span class="white">{{ app.settings.printer.name }}</span></li>
            <li>Location: <span class="white">{{ app.settings.printer.location }}</span></li>
            <li>Type: <span class="white">{{ printer.type | printer_type }}</span></li>
            <li>Port: <span class="white">{{ app.cfg.printer.port }}</span></li>
            <li>Baudrate: <span class="white">{{ app.cfg.printer.baudrate }}</span></li>
            <li>SN: <span class="white">{{ printer.sn }}</span></li>
            <li>Firmware: <span class="white">{{ printer.firmware }}</span></li>
            <li>Nozzle: <span class="white">{{ printer.nozzle_diameter }}</span></li>
            <li>SD Ready: <span class="white">{{ prusa_link.sd_ready }}</span></li>
        </ul>

        <h2 class="align-center">Prusa Link</h2>
        <ul>
            <li>Running: <span class="white">{{ prusa_link.running }}</span></li>
            <li>SDK State: <span class="white">{{ printer.state }}</span></li>
            <li>State history:</li>
            <ul>
            {%- for state in prusa_link.model.state_manager.state_history | reverse %}
            <li><span class="white">{{ state }}</span></li>
            {%- endfor %}
            <br>
            </ul>
            <li>Errors state:</li>
            <ul>
            {%- for error in errors %}
            {%- for key, (state, msg) in error.items() %}
            <li>{{ key }}: <span class="white">{{ msg if state == False else state }}</span></li>
            {%- endfor %}
            <br>
            {%- endfor %}
            </ul>
        </ul>

        {% if prusa_link.model.job.job_state.name != "IDLE" %}
        <h2 class="align-center">Job info</h2>
            <li>Job ID:
                <span class="white">{{ prusa_link.model.job.job_id }}</span>
            </li>
            <li>Job started by command with ID:
                <span class="white">{{ prusa_link.model.job.job_start_cmd_id }}</span>
            </li>
            <li>Printing file:
                <span class="white">{{ prusa_link.model.job.printing_file_path }}</span>
            </li>
            <li>Only file name shown:
                <span class="white">{{ prusa_link.model.job.filename_only }}</span>
            </li>
            <li>Last modified at:
                <span class="white">{{ prusa_link.model.job.printing_file_m_time }}</span>
            </li>
            <li>Size:
                <span class="white">{{ prusa_link.model.job.printing_file_size }}</span>
            </li>
            <li>From SD card:
                <span class="white">{{ prusa_link.model.job.from_sd }}</span>
            </li>
            <li>File contains inbuilt print stats:
                <span class="white">{{ prusa_link.model.job.inbuilt_reporting }}</span>
            </li>
            <li>Byte position:
                <span class="white">{{ prusa_link.model.job.printing_file_byte }}/{{ prusa_link.model.job.printing_file_size }}</span>
            </li>
        {% endif %}

        <h2 class="align-center">Network</h2>
        {% if printer %}
        <ul>
            {%- for key, val in printer.network_info.items() %}
            <li>{{ key }}: <span class="white">{{ val }}</span></li>
            {%- endfor %}
            <li>Api-Key: <span class="white">{{ printer.api_key }}</span></li>
        </ul>
        {% endif %}


        <h2 class="align-center">Connect</h2>
        <ul>
            <li>Server: <span class="white">{{ printer.server }}</span></li>
            <li>Fingerprint: <span class="white">{{ printer.fingerprint }}</span></li>
            <li>Token: <span class="white">{{ printer.token }}</span></li>
        {% if prusa_link %}
            <li>Last Telemetry: <span class="white">{{ prusa_link.last_sent_telemetry }}</span></li>
            <ul>
                {%- for key, val in prusa_link.model.last_telemetry %}
                <li>{{ key }}: <span class="white">{{ val }}</span></li>
                {%- endfor %}
            </ul>
        {% endif %}
        </ul>

        <h2 class="align-center">Files</h2>
        {% if printer %}
        <pre>
            {{ printer.get_info()["files"]|pprint }}
        </pre>
        {% endif %}
    </div>

  </div>

  <footer class="footer mt-auto py-3">
      <div class="container">

{% include "_footer.html" %}
